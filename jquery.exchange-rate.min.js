$.fn.exchangeRate=function(t){var e=$.extend({updateInterval:3600,margin:10,insertBefore:"",insertAfter:""},t);Number.prototype.formatMoney=function(t,e,a){var r=this,t=isNaN(t=Math.abs(t))?2:t,e=void 0==e?".":e,a=void 0==a?",":a,s=0>r?"-":"",i=parseInt(r=Math.abs(+r||0).toFixed(t))+"",o=(o=i.length)>3?o%3:0;return s+(o?i.substr(0,o)+a:"")+i.substr(o).replace(/(\d{3})(?=\d)/g,"$1"+a)+(t?e+Math.abs(r-i).toFixed(t).slice(2):"")},$.fn.positionBubble=function(t){var a=$(t).position();$(this).css("top",a.top-e.margin-$(this).outerHeight()),$(this).css("left",a.left+($(t).outerWidth()-$(this).outerWidth())/2)},$.fn.displayRateInfo=function(t){var e=parseFloat($(this).text().replace(/[^\d]+/,"")),a=(e*t).formatMoney(2,","," "),r=$(this).data("to");$(".rate-bubble").find("p").html(a+" "+r),$(".rate-bubble-wrapper").positionBubble(this)},$.fn.displayBubble=function(){var t=this,a=$(this).data("from").toUpperCase(),r=$(this).data("to").toUpperCase(),s=parseFloat($(this).data("rate"));if($(this).after('<div class="rate-bubble-wrapper"><div class="rate-bubble clearfix">'+e.insertBefore+"<p>fetching...</p>"+e.insertAfter+'</div><div class="rate-bubble-arrow"></div></div>'),$(".rate-bubble-wrapper").positionBubble(t),a&&r){var i=$(this).data("last-update"),o=(new Date).valueOf();!i||i+1e3*e.updateInterval<o?($(this).data("last-update",o),$.ajax({type:"GET",url:"http://query.yahooapis.com/v1/public/yql?q=select+rate,name+from+csv+where+url='http://download.finance.yahoo.com/d/quotes?s="+a+r+"%253DX%26f%3Dl1n'+and+columns='rate,name'&format=json&callback=",dataType:"json",success:function(e){$(t).data("rate",e.query.results.row.rate),s=parseFloat($(t).data("rate")),$(t).displayRateInfo(s)}})):$(this).displayRateInfo(s)}},$.ajaxSetup({cache:!1}),$(this).click(function(t){t.preventDefault()}),$(this).mouseenter(function(t){$(this).displayBubble()}),$(this).mouseleave(function(t){$(".rate-bubble-wrapper").remove()})};